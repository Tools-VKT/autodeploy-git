# ü§ñ autodeploy-git

–ü—Ä–æ—Å—Ç–æ–π –±–µ–∫–µ–Ω–¥ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è **webhook'–æ–≤** –æ—Ç Github —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –¥–µ–ø–ª–æ–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–ù–∞ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è [`pm2`](https://pm2.keymetrics.io/docs/usage/quick-start/) (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤) –∏ `git`. `git` –Ω–µ —Å–º–æ–∂–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –∞–∫–∫–∞—É–Ω—Ç–µ (–ø–æ –∫–æ–º–∞–Ω–¥–µ `gh auth login`)

–ü—Ä–∏–º–µ—Ä –¥–ª—è `Ubuntu` —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤:
```
npm install pm2@latest -g
apt-get install git
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `gh` –≤ `Ubuntu`:
```bash
type -p curl >/dev/null || (sudo apt update && sudo apt install curl -y)
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
&& sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
&& echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
&& sudo apt update \
&& sudo apt install gh -y
```

## üíª –ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å?
1. –ö–æ–ø–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –±–µ–∫–µ–Ω–¥–æ–º:
```
git clone https://github.com/reyzitwo/autodeploy-git.git <dir-name>
```
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
```
npm i
```
3. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `.env` –ø–æ –ø—Ä–∏–º–µ—Ä—É –∏–∑ `.env.example`, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ —É–∫–∞–∑—ã–≤–∞–µ–º –ª—é–±—É—é —Å—Ç—Ä–æ–∫—É. –ü—Ä–∏–≥–æ–¥–∏—Ç—Å—è –Ω–∞–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç –ª–∏—Ü–∞ **Github**.
4. –ó–∞–ø—É—Å–∫–∞–µ–º –±–µ–∫–µ–Ω–¥:
```
npm start:prod
```
5. –ì–æ—Ç–æ–≤–æ! –ë–µ–∫–µ–Ω–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –∞–¥—Ä–µ—Å—É `{SERVER}/autodeploy-git`, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ —Ä—É—á–∫–µ `/deploy`.

–°–∞–º —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –ø–æ –ø–æ—Ä—Ç—É `3000`, –Ω–æ —ç—Ç–æ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –≤ —Ñ–∞–π–ª–µ `./src/main.ts`

## üõ† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?
1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤–æ –≤–∫–ª–∞–¥–∫—É **Settings** -> **Webhooks**
2. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π webhook, —É–∫–∞–∑–∞–≤ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–Ω—è—Ç—ã–º –±–µ–∫–µ–Ω–¥–æ–º (‚ÄºÔ∏è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å `secret` –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º, –∫–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –±—É–¥–µ–º –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç Github (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ `Pushes`)
4. ‚úÖ Profit!

–ù–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –Ω–∞–º–∏ URL –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è `POST` –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `./src/scripts/deploy.sh`

## –ê –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∞–º `deploy.sh`?
–°–∫—Ä–∏–ø—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–º—è –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø—É—Ç—å –¥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Github (–Ω–∞–ø—Ä–∏–º–µ—Ä: `reyzitwo/autodeploy-git`). –í—Å–µ —ç—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–æ–¥–µ, –Ω–∏—á–µ–≥–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—ã–∑–æ–≤–∞ –Ω–µ –Ω—É–∂–Ω–æ.

–ê —Å–∞–º –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

**–∞)** –ï—Å–ª–∏ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç:
1. –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø–∞–ø–∫—É `$HOME/git/$PROJECT_NAME`
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
3. –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `pm2` –ø–æ –∫–æ–º–∞–Ω–¥–µ `npm run autodeploy-gh` (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∑–∞–ø—É—Å–∫ –≤ `package.json`)

**–±)** –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —É–∂–µ –∏–º–µ–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ `pm2`
2. –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å Github: `git pull`
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
4. –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `pm2`